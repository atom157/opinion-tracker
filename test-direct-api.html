<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opinion Portfolio Tracker - Test Direct API</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        function OpinionPortfolioTracker() {
            const [walletAddress, setWalletAddress] = useState('');
            const [inputAddress, setInputAddress] = useState('');
            const [positions, setPositions] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            // ‚ö†Ô∏è –¢–ï–°–¢–û–í–ê –í–ï–†–°–Ü–Ø - –ø—Ä—è–º—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ API (–º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ CORS)
            const API_KEY = 'ehtBldzeqaB88gW0YeWcz6ku5M2R9KO8';
            const BASE_URL = 'https://openapi.opinion.trade/openapi';

            const fetchData = async (address) => {
                if (!address || address.length < 10) {
                    setError('–í–≤–µ–¥—ñ—Ç—å –≤–∞–ª—ñ–¥–Ω—É –∞–¥—Ä–µ—Å—É');
                    return;
                }

                setLoading(true);
                setError('');

                try {
                    console.log('üîç Testing direct API call to:', `${BASE_URL}/positions/user/${address}`);
                    
                    const response = await fetch(`${BASE_URL}/positions/user/${address}?limit=50`, {
                        headers: {
                            'apikey': API_KEY,
                            'Accept': 'application/json'
                        }
                    });

                    console.log('üì° Response status:', response.status);
                    console.log('üì° Response headers:', [...response.headers.entries()]);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log('‚úÖ Data received:', data);

                    if (data.code === 0 && data.result) {
                        const posList = data.result.list || [];
                        setPositions(posList);
                        setWalletAddress(address);
                        
                        if (posList.length === 0) {
                            setError('‚ÑπÔ∏è –ì–∞–º–∞–Ω–µ—Ü—å –∑–Ω–∞–π–¥–µ–Ω–æ, –∞–ª–µ –Ω–µ–º–∞—î –ø–æ–∑–∏—Ü—ñ–π');
                        }
                    } else {
                        setError(`‚ö†Ô∏è API –≤—ñ–¥–ø–æ–≤—ñ–≤: code=${data.code}, msg=${data.msg || 'Unknown'}`);
                    }
                } catch (err) {
                    console.error('‚ùå Error:', err);
                    setError(`‚ùå ${err.message}`);
                    
                    if (err.message.includes('CORS')) {
                        setError('‚ùå CORS Error - –ø–æ—Ç—Ä—ñ–±–µ–Ω –±–µ–∫–µ–Ω–¥ –ø—Ä–æ–∫—Å—ñ! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Vercel –¥–µ–ø–ª–æ–π.');
                    }
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-black via-gray-900 to-black p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-bold text-white mb-2">
                                üß™ Test Direct API
                            </h1>
                            <p className="text-orange-300">
                                –¶—è –≤–µ—Ä—Å—ñ—è –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ API –Ω–∞–ø—Ä—è–º—É (–º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ CORS)
                            </p>
                        </div>

                        <div className="bg-gray-800 rounded-2xl p-6 mb-6">
                            <div className="flex gap-3">
                                <input
                                    type="text"
                                    placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É –≥–∞–º–∞–Ω—Ü—è (0x...)"
                                    value={inputAddress}
                                    onChange={(e) => setInputAddress(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && fetchData(inputAddress)}
                                    className="flex-1 px-4 py-3 rounded-lg bg-gray-900 text-white border border-orange-500/30"
                                />
                                <button
                                    onClick={() => fetchData(inputAddress)}
                                    disabled={loading}
                                    className="px-6 py-3 bg-orange-500 hover:bg-orange-600 rounded-lg font-semibold disabled:opacity-50"
                                >
                                    {loading ? '‚è≥' : 'üîç'} –ü–æ—à—É–∫
                                </button>
                            </div>

                            {error && (
                                <div className="mt-4 p-4 bg-red-500/20 border border-red-500 rounded-lg text-red-300">
                                    {error}
                                </div>
                            )}

                            {walletAddress && !error && (
                                <div className="mt-4 p-4 bg-green-500/20 border border-green-500 rounded-lg text-green-300">
                                    ‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ {positions.length} –ø–æ–∑–∏—Ü—ñ–π
                                </div>
                            )}
                        </div>

                        <div className="bg-gray-800 rounded-2xl p-6">
                            <h2 className="text-2xl font-bold text-white mb-4">üìã Console Debug Info</h2>
                            <div className="bg-gray-900 p-4 rounded-lg text-sm text-gray-300 font-mono overflow-auto max-h-96">
                                <p>üîó API Endpoint: {BASE_URL}/positions/user/[ADDRESS]</p>
                                <p>üîë API Key: {API_KEY.substring(0, 10)}...</p>
                                <p>üìç –°—Ç–∞—Ç—É—Å: {loading ? '‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...' : '‚úÖ –ì–æ—Ç–æ–≤–æ'}</p>
                                <p className="mt-4">üí° –í—ñ–¥–∫—Ä–∏–π—Ç–µ DevTools Console (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π</p>
                                {positions.length > 0 && (
                                    <pre className="mt-4 text-xs">
                                        {JSON.stringify(positions[0], null, 2).substring(0, 500)}...
                                    </pre>
                                )}
                            </div>
                        </div>

                        <div className="mt-6 p-4 bg-blue-500/20 border border-blue-500 rounded-lg text-blue-300">
                            <h3 className="font-bold mb-2">‚ÑπÔ∏è –í–∞–∂–ª–∏–≤–æ:</h3>
                            <ul className="list-disc list-inside space-y-1 text-sm">
                                <li>–¶—è –≤–µ—Ä—Å—ñ—è –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è - –º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ CORS</li>
                                <li>–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Vercel –∑ API routes</li>
                                <li>–í—Å—ñ –∑–∞–ø–∏—Ç–∏ –ª–æ–≥—É—é—Ç—å—Å—è –≤ Console (F12)</li>
                                <li>–Ø–∫—â–æ –±–∞—á–∏—Ç–µ CORS error - –≤—Å–µ –û–ö, –ø—Ä–æ—Å—Ç–æ –∑–∞–¥–µ–ø–ª–æ–π—Ç–µ –Ω–∞ Vercel</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<OpinionPortfolioTracker />);
    </script>
</body>
</html>
